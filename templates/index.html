<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 스터디 플래너</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Firebase SDK 추가 -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <style>
        :root {
            --bg-primary: #1e293b; --bg-secondary: #0f172a; --bg-tertiary: #334155;
            --border-primary: #334155; --text-primary: #f1f5f9; --text-secondary: #94a3b8;
            --accent-primary: #38bdf8; --accent-secondary: #0ea5e9;
        }
        html.light {
            --bg-primary: #ffffff; --bg-secondary: #f8fafc; --bg-tertiary: #f1f5f9;
            --border-primary: #e2e8f0; --text-primary: #1e293b; --text-secondary: #64748b;
        }
        body { font-family: 'Inter', sans-serif; -webkit-font-smoothing: antialiased; background-color: var(--bg-secondary); color: var(--text-primary); }
        .task-item.completed span.task-text { text-decoration: line-through; color: var(--text-secondary); }
        .category-item:hover .delete-category-btn { opacity: 1; }
        .sidebar { transition: transform 0.3s ease-in-out; }
        @media (max-width: 1279px) { .sidebar:not(.open) { transform: translateX(-100%); } }
        @keyframes shake { 10%, 90% { transform: translateX(-1px); } 20%, 80% { transform: translateX(2px); } 30%, 50%, 70% { transform: translateX(-4px); } 40%, 60% { transform: translateX(4px); } }
        .shake { animation: shake 0.82s cubic-bezier(.36,.07,.19,.97) both; }
        .modal { transition: opacity 0.3s ease-in-out; }
        .modal-content { transition: transform 0.3s ease-in-out; }
        @keyframes toast-in { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .toast { animation: toast-in 0.5s ease-out forwards; }
    </style>
</head>
<body>
    <div id="app" class="flex h-screen bg-[var(--bg-secondary)] text-[var(--text-primary)]">
        <!-- Sidebar -->
        <aside id="sidebar" class="sidebar absolute xl:static w-72 bg-[var(--bg-primary)] p-6 border-r border-[var(--border-primary)] flex flex-col flex-shrink-0 z-20 h-full">
             <div class="flex items-center justify-between mb-6">
                <div class="flex items-center gap-3">
                    <i class="fa-solid fa-rocket text-3xl text-[var(--accent-secondary)]"></i>
                    <h1 class="text-2xl font-bold">Planner</h1>
                </div>
                <button id="theme-toggle" class="text-xl text-[var(--text-secondary)] hover:text-[var(--accent-primary)]"><i class="fa-solid fa-sun"></i></button>
            </div>

            <!-- Auth Section -->
            <div id="auth-section" class="mb-4">
                <button id="login-btn" class="w-full flex items-center justify-center gap-2 p-2.5 rounded-lg bg-white text-gray-800 hover:bg-gray-200 font-semibold transition">
                    <i class="fa-brands fa-google"></i>
                    <span>Google로 로그인</span>
                </button>
                <div id="user-profile" class="hidden items-center justify-between">
                    <div class="flex items-center gap-2 overflow-hidden">
                        <img id="user-avatar" class="w-8 h-8 rounded-full" src="" alt="User Avatar">
                        <span id="user-name" class="font-semibold text-sm truncate"></span>
                    </div>
                    <button id="logout-btn" data-auth-required class="text-sm text-[var(--text-secondary)] hover:text-red-400 font-semibold flex-shrink-0">로그아웃</button>
                </div>
            </div>
            
            <div class="flex gap-2 mb-2">
                <button id="open-dashboard-btn" data-auth-required class="w-1/2 flex items-center justify-center gap-2 p-2.5 rounded-lg bg-slate-700 hover:bg-slate-600 font-semibold transition disabled:opacity-50 disabled:cursor-not-allowed">
                    <i class="fa-solid fa-chart-line"></i><span>대시보드</span>
                </button>
                <button id="open-achievements-btn" data-auth-required class="w-1/2 flex items-center justify-center gap-2 p-2.5 rounded-lg bg-slate-700 hover:bg-slate-600 font-semibold transition disabled:opacity-50 disabled:cursor-not-allowed">
                    <i class="fa-solid fa-trophy"></i><span>업적</span>
                </button>
            </div>
            <div id="streak-display" class="text-center text-sm text-orange-400 mb-4 font-semibold hidden"></div>

            <nav id="category-list" class="space-y-1.5 flex-grow overflow-y-auto"></nav>
            <div class="mt-auto pt-4 border-t border-[var(--border-primary)]">
                <input type="text" id="new-category-name" data-auth-required class="w-full p-2 bg-[var(--bg-tertiary)] border border-[var(--border-primary)] rounded-md text-sm focus:ring-2 focus:ring-[var(--accent-secondary)] focus:outline-none" placeholder="새 카테고리">
                <div class="flex items-center gap-2 mt-2">
                    <input type="color" id="new-category-color" data-auth-required value="#0ea5e9" class="w-10 h-10 p-1 bg-transparent border border-[var(--border-primary)] rounded-md cursor-pointer">
                    <button id="add-category-btn" data-auth-required class="w-full bg-slate-600 text-white p-2 rounded-md hover:bg-slate-500 transition font-semibold disabled:opacity-50 disabled:cursor-not-allowed">카테고리 추가</button>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-4 sm:p-6 md:p-10 overflow-y-auto">
            <header class="flex flex-wrap items-center justify-between gap-4 mb-8">
                <div class="flex items-center gap-4">
                    <h2 id="main-title" class="text-3xl font-bold">모든 할 일</h2>
                    <button id="open-ai-modal-btn" data-auth-required class="bg-sky-500/20 text-sky-400 font-semibold px-4 py-2 rounded-lg text-sm hover:bg-sky-500/30 transition disabled:opacity-50 disabled:cursor-not-allowed">AI 플래너 ✨</button>
                </div>
                <div class="flex items-center gap-4">
                     <select id="sort-select" data-auth-required class="p-2 bg-[var(--bg-primary)] border border-[var(--border-primary)] rounded-lg text-sm focus:ring-2 focus:ring-[var(--accent-secondary)] focus:outline-none">
                         <option value="createdAt">생성순</option> <option value="dueDate">마감일순</option>
                     </select>
                     <button id="ai-sort-btn" data-auth-required class="p-2 bg-[var(--bg-tertiary)] rounded-lg text-sm font-semibold hover:bg-slate-600 transition disabled:opacity-50 disabled:cursor-not-allowed">AI 추천 순서 ✨</button>
                    <button id="menu-toggle" class="xl:hidden p-2 rounded-md hover:bg-[var(--bg-tertiary)]"><i class="fas fa-bars text-xl"></i></button>
                </div>
            </header>
            <div id="main-content-area" class="max-w-4xl">
                 <div id="login-prompt" class="text-center py-16">
                    <i class="fa-solid fa-right-to-bracket text-5xl text-[var(--text-secondary)] mb-4"></i>
                    <p class="text-[var(--text-secondary)]">Google 계정으로 로그인하여<br>나만의 AI 플래너를 시작해보세요!</p>
                </div>
                <div id="task-area" class="hidden">
                    <div id="task-input-container" class="space-y-2 mb-8">
                        <div class="relative">
                            <input type="text" id="new-task-input" data-auth-required class="w-full p-3 bg-[var(--bg-primary)] border border-[var(--border-primary)] rounded-lg text-sm focus:ring-2 focus:ring-[var(--accent-secondary)] focus:outline-none" placeholder="AI에게 맡겨보세요! 예: 알고리즘 공부 내일 저녁 7시까지 #코딩">
                            <button id="magic-fill-btn" data-auth-required class="absolute top-1/2 right-3 -translate-y-1/2 text-sky-400 font-semibold text-sm hover:text-sky-300 flex items-center gap-2" title="AI로 자동 채우기">
                                <span class="btn-text">AI로 채우기</span>
                                <i class="fa-solid fa-wand-magic-sparkles"></i>
                                <div class="spinner hidden w-4 h-4 border-2 border-t-transparent border-white rounded-full animate-spin"></div>
                            </button>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
                            <input type="date" id="new-task-due-date" data-auth-required class="p-3 bg-[var(--bg-primary)] border border-[var(--border-primary)] rounded-lg text-sm">
                            <select id="task-category-select" data-auth-required class="p-3 bg-[var(--bg-primary)] border border-[var(--border-primary)] rounded-lg text-sm focus:ring-2 focus:ring-[var(--accent-secondary)] focus:outline-none"></select>
                        </div>
                        <button id="add-task-btn" data-auth-required class="w-full bg-[var(--accent-secondary)] text-white p-3 rounded-lg font-semibold hover:bg-[var(--accent-primary)] transition shadow-sm">할 일 추가</button>
                    </div>
                    <div id="task-list" class="space-y-3"></div>
                </div>
            </div>
        </main>
        
        <!-- Right Panel -->
        <aside class="hidden xl:block w-80 bg-[var(--bg-primary)] p-6 border-l border-[var(--border-primary)]">
            <div id="pomodoro-timer" class="text-center">
                <h2 class="text-xl font-bold mb-4">뽀모도로 타이머</h2>
                <div class="relative w-48 h-48 mx-auto mb-4">
                    <svg class="w-full h-full" viewBox="0 0 100 100">
                        <circle class="text-[var(--bg-tertiary)]" stroke-width="8" stroke="currentColor" fill="transparent" r="45" cx="50" cy="50" />
                        <circle id="pomodoro-progress" class="text-[var(--accent-secondary)]" stroke-width="8" stroke-linecap="round" stroke="currentColor" fill="transparent" r="45" cx="50" cy="50" style="transform: rotate(-90deg); transform-origin: 50% 50%; transition: stroke-dashoffset 0.5s;" />
                    </svg>
                    <div id="pomodoro-time" class="absolute inset-0 flex items-center justify-center text-4xl font-bold">25:00</div>
                </div>
                <div class="flex justify-center gap-2">
                    <button id="pomodoro-start-pause" class="bg-[var(--accent-secondary)] text-white px-4 py-2 rounded-lg w-24 font-semibold hover:bg-[var(--accent-primary)] transition">시작</button>
                    <button id="pomodoro-reset" class="bg-[var(--bg-tertiary)] px-4 py-2 rounded-lg w-24 font-semibold hover:bg-slate-600 transition">리셋</button>
                </div>
            </div>
            <div id="progress-dashboard" class="mt-10">
                <h2 class="text-xl font-bold mb-4">오늘의 진행 상황</h2>
                <div class="bg-[var(--bg-tertiary)] p-4 rounded-xl">
                    <p id="progress-text" class="text-sm text-[var(--text-secondary)]">총 0개 할 일, 0개 완료.</p>
                    <div class="w-full bg-slate-600 rounded-full h-2.5 mt-2">
                        <div id="progress-bar" class="bg-[var(--accent-secondary)] h-2.5 rounded-full" style="width: 0%; transition: width 0.5s;"></div>
                    </div>
                </div>
            </div>
            <div id="quote-section" class="mt-10">
                <h2 class="text-xl font-bold mb-4">오늘의 명언</h2>
                <div class="bg-[var(--bg-tertiary)] p-4 rounded-xl">
                    <p id="quote-text" class="text-sm italic text-[var(--text-secondary)]"></p>
                    <p id="quote-author" class="text-xs text-right mt-2 font-semibold"></p>
                </div>
            </div>
        </aside>
    </div>

    <!-- Modals -->
    <div id="ai-planner-modal" class="modal fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50 opacity-0 pointer-events-none">
        <div class="modal-content bg-[var(--bg-primary)] w-full max-w-lg p-8 rounded-2xl shadow-2xl border border-[var(--border-primary)] transform scale-95">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-2xl font-bold flex items-center gap-3"><i class="fa-solid fa-wand-magic-sparkles text-[var(--accent-primary)]"></i> AI 플래너</h3>
                <button id="close-ai-modal-btn" class="text-xl text-[var(--text-secondary)] hover:text-red-500">&times;</button>
            </div>
            <textarea id="ai-goal-input" class="w-full p-3 bg-[var(--bg-tertiary)] border border-[var(--border-primary)] rounded-lg text-sm focus:ring-2 focus:ring-[var(--accent-secondary)] focus:outline-none resize-none" rows="4" placeholder="예: 3주 안에 빵 만들기..."></textarea>
            <div class="flex items-center mt-4">
                <input type="checkbox" id="ai-include-pomodoro" class="h-4 w-4 rounded border-gray-300 text-sky-600 focus:ring-sky-500">
                <label for="ai-include-pomodoro" class="ml-2 block text-sm text-[var(--text-secondary)]">뽀모도로 세션 추천 포함</label>
            </div>
            <button id="generate-tasks-btn" class="mt-4 w-full bg-[var(--accent-secondary)] text-white p-3 rounded-lg font-semibold hover:bg-[var(--accent-primary)] transition shadow-sm flex items-center justify-center gap-2">
                <span class="btn-text">생성하기</span>
                <div class="spinner hidden w-5 h-5 border-2 border-t-transparent border-white rounded-full animate-spin"></div>
            </button>
        </div>
    </div>
    
    <div id="dashboard-modal" class="modal fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50 opacity-0 pointer-events-none">
        <div class="modal-content bg-[var(--bg-primary)] w-full max-w-3xl p-8 rounded-2xl shadow-2xl border border-[var(--border-primary)] transform scale-95">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-2xl font-bold flex items-center gap-3"><i class="fa-solid fa-chart-line text-[var(--accent-primary)]"></i> 생산성 대시보드</h3>
                <button id="close-dashboard-btn" class="text-xl text-[var(--text-secondary)] hover:text-red-500">&times;</button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div>
                    <h4 class="text-lg font-semibold mb-4">주간 완료 현황</h4>
                    <div class="bg-[var(--bg-tertiary)] p-4 rounded-lg"><canvas id="weekly-progress-chart"></canvas></div>
                </div>
                <div>
                    <h4 class="text-lg font-semibold mb-4">카테고리별 분포</h4>
                    <div class="bg-[var(--bg-tertiary)] p-4 rounded-lg flex justify-center items-center h-full"><canvas id="category-distribution-chart" style="max-height: 250px;"></canvas></div>
                </div>
            </div>
        </div>
    </div>

    <div id="achievements-modal" class="modal fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50 opacity-0 pointer-events-none">
        <div class="modal-content bg-[var(--bg-primary)] w-full max-w-lg p-8 rounded-2xl shadow-2xl border border-[var(--border-primary)] transform scale-95">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-2xl font-bold flex items-center gap-3"><i class="fa-solid fa-trophy text-amber-400"></i> 달성한 업적</h3>
                <button id="close-achievements-btn" class="text-xl text-[var(--text-secondary)] hover:text-red-500">&times;</button>
            </div>
            <div id="achievements-list" class="space-y-3 max-h-96 overflow-y-auto"></div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notification-container" class="fixed top-5 right-5 z-[100] space-y-2"></div>
    <script>
        // --- Firebase Configuration ---
        // ※ 중요: 이 부분을 Firebase 설정 가이드 2단계에서 복사한 `firebaseConfig` 코드로 교체해주세요!
        const firebaseConfig = {
            apiKey: "AIzaSyB-D0tqBTQ1-AQTfJMIAmCGv2aGIBlWqSE",
            authDomain: "ai-study-planner-4fc7a.firebaseapp.com",
            projectId: "ai-study-planner-4fc7a",
            storageBucket: "ai-study-planner-4fc7a.appspot.com",
            messagingSenderId: "276956440219",
            appId: "1:276956440219:web:eba97d50273f20ad4fc83e"
        };
        
        // --- ✨ 올바른 초기화 방식 (v8) ---
        firebase.initializeApp(firebaseConfig);
        // ------------------------------------
    </script>
    <script src="/static/app.js" defer></script>
</body>
</html>

